<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Technology for Smart Education (TSE) System - International University of Papua</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-image: 
                linear-gradient(rgba(255, 255, 255, 0.3), rgba(255, 255, 255, 0.3)),
                url('https://vahatmjmttmnhcadrnpl.supabase.co/storage/v1/object/public/Logo/IUP-LOGO-TIPE-B.jpg');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            background-attachment: fixed;
            min-height: 100vh;
            line-height: 1.6;
        }
        
        body.login-page {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Login Styles */
        .header {
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 50px rgba(0, 0, 0, 0.15);
            width: 90%;
            max-width: 500px;
            padding: 50px 40px;
            text-align: center;
            margin: 0 auto;
        }

        .logo {
            margin-bottom: 25px;
        }

        .logo img {
            max-width: 180px;
            height: auto;
        }

        .welcome-section {
            margin-bottom: 30px;
        }

        .header h1 {
            color: #2c3e50;
            font-size: 1.5em;
            font-weight: 700;
            margin-bottom: 12px;
            line-height: 1.3;
        }

        .header .subtitle {
            color: #6c757d;
            font-size: 1em;
            margin-bottom: 20px;
        }

        .login-section {
            background: #f8f9fa;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            padding: 30px;
            margin-bottom: 20px;
        }

        .form-input {
            width: 100%;
            padding: 14px 18px;
            border: 1px solid #ced4da;
            border-radius: 6px;
            font-size: 15px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
            background: white;
        }

        .form-input:focus {
            outline: none;
            border-color: #1a4d7a;
            background: white;
            box-shadow: 0 0 0 3px rgba(26, 77, 122, 0.1);
        }

        .form-input::placeholder {
            color: #adb5bd;
        }

        .login-btn {
            width: 100%;
            background: #1a4d7a;
            color: white;
            border: none;
            padding: 14px;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .login-btn:hover {
            background: #143d5f;
            box-shadow: 0 4px 15px rgba(26, 77, 122, 0.3);
        }

        .login-btn:active {
            transform: translateY(1px);
        }

        .login-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #1a4d7a;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-spinner {
            display: none;
            text-align: center;
            padding: 20px;
            color: #6c757d;
        }

        .demo-credentials {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            padding: 15px;
            margin-top: 20px;
            text-align: center;
            font-size: 0.9em;
            color: #6c757d;
        }

        .demo-credentials p {
            margin: 0;
            line-height: 1.6;
        }

        .demo-credentials strong {
            color: #495057;
        }

        /* Dashboard Styles */
        .main-content {
            display: none;
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Top Navigation Bar */
        .top-nav {
            background: white;
            border-radius: 12px;
            padding: 15px 30px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .top-nav-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .top-nav-logo {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            object-fit: cover;
        }

        .top-nav-title {
            font-size: 1.2em;
            font-weight: 600;
            color: #2c3e50;
        }

        .user-menu {
            position: relative;
        }

        .user-icon {
            width: 45px;
            height: 45px;
            background: #1a4d7a;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 20px;
            transition: all 0.3s ease;
        }

        .user-icon:hover {
            background: #143d5f;
            transform: scale(1.05);
        }

        .user-dropdown {
            display: none;
            position: absolute;
            top: 55px;
            right: 0;
            background: white;
            border-radius: 8px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.15);
            min-width: 200px;
            z-index: 1000;
            animation: dropdownFade 0.3s ease;
        }

        @keyframes dropdownFade {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .user-dropdown.show {
            display: block;
        }

        .user-info {
            padding: 15px;
            border-bottom: 1px solid #e9ecef;
        }

        .user-role {
            font-size: 0.9em;
            color: #6c757d;
            margin-bottom: 5px;
        }

        .user-email {
            font-size: 0.85em;
            color: #495057;
            font-weight: 500;
        }

        .logout-btn {
            width: 100%;
            background: #e74c3c;
            color: white;
            border: none;
            padding: 12px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            border-radius: 0 0 8px 8px;
            transition: all 0.3s ease;
        }

        .logout-btn:hover {
            background: #c0392b;
        }

        /* Tab Navigation */
        .nav-tabs {
            display: flex;
            background: white;
            border-radius: 12px;
            padding: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            gap: 10px;
        }

        .nav-tab {
            flex: 1;
            padding: 12px 20px;
            background: transparent;
            border: none;
            border-radius: 8px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #6c757d;
        }

        .nav-tab.active {
            background: #17a2b8;
            color: white;
        }

        .nav-tab:hover:not(.active) {
            background: rgba(23, 162, 184, 0.1);
            color: #17a2b8;
        }

        /* Dashboard Layout */
        .dashboard-layout {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 20px;
        }

        .main-column {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .sidebar-column {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .sidebar-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .sidebar-title {
            font-size: 1.1em;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #17a2b8;
        }

        .schedule-item {
            background: #f8f9fa;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 4px solid #17a2b8;
        }

        .schedule-course {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .schedule-time {
            font-size: 0.85em;
            color: #6c757d;
        }

        .course-item {
            background: #f8f9fa;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .course-name {
            font-weight: 600;
            color: #2c3e50;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 3px solid #17a2b8;
        }

        .section-title {
            color: #2c3e50;
            font-size: 1.8em;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .add-btn {
            background: #17a2b8;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .add-btn:hover {
            background: #138496;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(23, 162, 184, 0.3);
        }

        .announcement-card {
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
        }

        .announcement-card:hover {
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            transform: translateY(-2px);
        }

        .announcement-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 10px;
        }

        .announcement-title {
            font-size: 1.2em;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .announcement-date {
            font-size: 0.85em;
            color: #6c757d;
        }

        .announcement-content {
            color: #495057;
            line-height: 1.6;
        }

        .delete-btn {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 5px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .delete-btn:hover {
            background: #c0392b;
            transform: translateY(-1px);
        }

        /* Course Grid */
        .course-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }

        .course-card {
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 10px;
            padding: 20px;
            transition: all 0.3s ease;
            border-left: 5px solid #17a2b8;
        }

        .course-card:hover {
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            transform: translateY(-2px);
        }

        .course-title {
            font-size: 1.2em;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 8px;
        }

        .course-info {
            color: #6c757d;
            font-size: 0.9em;
            margin-bottom: 12px;
        }

        .course-description {
            color: #495057;
            margin-bottom: 15px;
            line-height: 1.6;
        }

        .course-btn {
            width: 100%;
            background: #17a2b8;
            color: white;
            border: none;
            padding: 10px;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .course-btn:hover {
            background: #138496;
        }

        /* Schedule Table */
        .schedule-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .schedule-table th {
            background: #17a2b8;
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }

        .schedule-table td {
            padding: 15px;
            border-bottom: 1px solid #e9ecef;
        }

        .schedule-table tr:hover {
            background: rgba(23, 162, 184, 0.05);
        }

        .time-slot {
            font-weight: 600;
            color: #17a2b8;
        }

        /* Forms */
        .edit-form {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
        }

        .form-textarea, .form-select {
            width: 100%;
            padding: 12px;
            border: 1px solid #ced4da;
            border-radius: 6px;
            font-size: 15px;
            transition: border-color 0.3s ease;
        }

        .form-input:focus, .form-textarea:focus, .form-select:focus {
            outline: none;
            border-color: #17a2b8;
            box-shadow: 0 0 0 3px rgba(23, 162, 184, 0.1);
        }

        .form-textarea {
            min-height: 120px;
            resize: vertical;
        }

        .save-btn {
            background: #17a2b8;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-right: 10px;
        }

        .save-btn:hover {
            background: #138496;
            transform: translateY(-2px);
        }

        .cancel-btn {
            background: #6c757d;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .cancel-btn:hover {
            background: #5a6268;
        }

        /* Modal */
        .course-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 2000;
            animation: fadeIn 0.3s ease;
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border-radius: 12px;
            padding: 30px;
            max-width: 800px;
            max-height: 90vh;
            width: 90%;
            overflow-y: auto;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e9ecef;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #6c757d;
            transition: color 0.3s ease;
        }

        .close-btn:hover {
            color: #e74c3c;
        }

        .module-item {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 12px;
            border-left: 4px solid #17a2b8;
        }

        .module-title {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 8px;
        }

        .file-link {
            color: #17a2b8;
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s ease;
        }

        .file-link:hover {
            color: #138496;
            text-decoration: underline;
        }

        .error-message {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #6c757d;
        }

        .admin-only {
            display: none;
        }

        @media (max-width: 1024px) {
            .dashboard-layout {
                grid-template-columns: 1fr;
            }

            .sidebar-column {
                order: -1;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .header {
                padding: 40px 25px;
            }
            
            .header h1 {
                font-size: 1.3em;
            }
            
            .logo img {
                max-width: 150px;
            }
            
            .login-section {
                padding: 25px 20px;
            }

            .top-nav {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }

            .nav-tabs {
                flex-direction: column;
            }

            .course-grid {
                grid-template-columns: 1fr;
            }

            .modal-content {
                width: 95%;
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Login Header -->
        <div class="header">
            <div class="logo">
                <img src="https://vahatmjmttmnhcadrnpl.supabase.co/storage/v1/object/public/Logo/IUP-LOGO-TIPE-B.jpg" alt="IUP Logo">
            </div>

            <div class="welcome-section">
                <h1>🎓 Welcome to Technology for Smart Education (TSE)</h1>
                <div class="subtitle">International University of Papua</div>
            </div>

            <div class="error-message" id="loginError"></div>

            <div class="loading-spinner" id="loadingSpinner">
                <div class="spinner"></div>
                <p>Logging in...</p>
            </div>
            
            <div class="login-section" id="loginSection">
                <div class="form-group">
                    <input type="email" class="form-input" id="loginEmail" placeholder="Username or Email" autocomplete="email" required>
                </div>

                <div class="form-group">
                    <input type="password" class="form-input" id="loginPassword" placeholder="Password" autocomplete="current-password" required>
                </div>

                <button class="login-btn" id="loginButton" onclick="login()">Masuk</button>
            </div>

            <div class="demo-credentials">
                <p>
                    <strong>Login untuk mahasiswa:</strong><br>
                    student@iup.ac.id / student123!
                </p>
            </div>
        </div>

        <!-- Main Content (Dashboard) -->
        <div class="main-content" id="mainContent">
            <!-- Top Navigation -->
            <div class="top-nav">
                <div class="top-nav-left">
                    <img src="https://vahatmjmttmnhcadrnpl.supabase.co/storage/v1/object/public/Logo/IUP-LOGO-TIPE-B.jpg" alt="Logo" class="top-nav-logo">
                    <div class="top-nav-title">TSE System - International University of Papua</div>
                </div>
                <div class="user-menu">
                    <div class="user-icon" onclick="toggleUserDropdown()">
                        👤
                    </div>
                    <div class="user-dropdown" id="userDropdown">
                        <div class="user-info">
                            <div class="user-role" id="userRole">Student</div>
                            <div class="user-email" id="userEmail">student@iup.ac.id</div>
                        </div>
                        <button class="logout-btn" onclick="logout()">Keluar</button>
                    </div>
                </div>
            </div>

            <!-- Tab Navigation -->
            <div class="nav-tabs">
                <button class="nav-tab active" onclick="showSection('announcements')">📢 Pengumuman</button>
                <button class="nav-tab" onclick="showSection('schedule')">📅 Jadwal Kuliah</button>
                <button class="nav-tab" onclick="showSection('courses')">📚 Mata Kuliah</button>
            </div>

            <!-- Dashboard Layout -->
            <div class="dashboard-layout">
                <!-- Main Column -->
                <div class="main-column">
                    <!-- Announcements Section -->
                    <div class="content-section active" id="announcements">
                        <div class="section-header">
                            <h2 class="section-title">📢 Pengumuman Terbaru</h2>
                            <button class="add-btn" id="addAnnouncementBtn" onclick="showAnnouncementForm()" style="display: none;">+ Tambah Pengumuman</button>
                        </div>
                        
                        <div class="error-message" id="announcementError"></div>
                        
                        <div class="edit-form" id="announcementForm" style="display: none;">
                            <h3 style="margin-bottom: 20px;">Tambah Pengumuman</h3>
                            <div class="form-group">
                                <label class="form-label">Judul Pengumuman</label>
                                <input type="text" class="form-input" id="announcementTitle" placeholder="Masukkan judul pengumuman">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Isi Pengumuman</label>
                                <textarea class="form-textarea" id="announcementContent" placeholder="Masukkan isi pengumuman"></textarea>
                            </div>
                            <button class="save-btn" onclick="saveAnnouncement()">Simpan Pengumuman</button>
                            <button class="cancel-btn" onclick="cancelAnnouncementEdit()">Batal</button>
                        </div>

                        <div id="announcementsList">
                            <div class="loading">Memuat pengumuman...</div>
                        </div>
                    </div>

                    <!-- Schedule Section -->
                    <div class="content-section" id="schedule" style="display: none;">
                        <div class="section-header">
                            <h2 class="section-title">📅 Jadwal Kuliah Mingguan</h2>
                            <button class="add-btn" id="addScheduleBtn" onclick="showScheduleForm()" style="display: none;">+ Tambah Jadwal</button>
                        </div>
                        
                        <div class="error-message" id="scheduleError"></div>
                        
                        <div class="edit-form" id="scheduleForm" style="display: none;">
                            <h3 style="margin-bottom: 20px;">Tambah Jadwal</h3>
                            <div class="form-group">
                                <label class="form-label">Hari</label>
                                <select class="form-select" id="scheduleDay">
                                    <option value="Senin">Senin</option>
                                    <option value="Selasa">Selasa</option>
                                    <option value="Rabu">Rabu</option>
                                    <option value="Kamis">Kamis</option>
                                    <option value="Jumat">Jumat</option>
                                    <option value="Sabtu">Sabtu</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Waktu</label>
                                <input type="text" class="form-input" id="scheduleTime" placeholder="08:00 - 09:40">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Mata Kuliah</label>
                                <input type="text" class="form-input" id="scheduleCourse" placeholder="Nama mata kuliah">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Ruangan</label>
                                <input type="text" class="form-input" id="scheduleRoom" placeholder="Ruang kelas">
                            </div>
                            <button class="save-btn" onclick="saveSchedule()">Simpan Jadwal</button>
                            <button class="cancel-btn" onclick="cancelScheduleEdit()">Batal</button>
                        </div>

                        <table class="schedule-table" id="scheduleTable">
                            <thead>
                                <tr>
                                    <th>Hari</th>
                                    <th>Waktu</th>
                                    <th>Mata Kuliah</th>
                                    <th>Ruangan</th>
                                    <th class="admin-only">Aksi</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td colspan="5" class="loading">Memuat jadwal...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- Courses Section -->
                    <div class="content-section" id="courses" style="display: none;">
                        <div class="section-header">
                            <h2 class="section-title">📚 Mata Kuliah & Materi</h2>
                            <button class="add-btn" id="addCourseBtn" onclick="showCourseForm()" style="display: none;">+ Tambah Mata Kuliah</button>
                        </div>
                        
                        <div class="error-message" id="courseError"></div>
                        
                        <div class="edit-form" id="courseForm" style="display: none;">
                            <h3 style="margin-bottom: 20px;">Tambah Mata Kuliah</h3>
                            <div class="form-group">
                                <label class="form-label">Nama Mata Kuliah</label>
                                <input type="text" class="form-input" id="courseName" placeholder="Nama mata kuliah">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Kode Mata Kuliah</label>
                                <input type="text" class="form-input" id="courseCode" placeholder="Kode mata kuliah">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Dosen Pengampu</label>
                                <input type="text" class="form-input" id="courseLecturer" placeholder="Nama dosen">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Deskripsi</label>
                                <textarea class="form-textarea" id="courseDescription" placeholder="Deskripsi mata kuliah"></textarea>
                            </div>
                            <button class="save-btn" onclick="saveCourse()">Simpan Mata Kuliah</button>
                            <button class="cancel-btn" onclick="cancelCourseEdit()">Batal</button>
                        </div>

                        <div class="course-grid" id="courseGrid">
                            <div class="loading">Memuat mata kuliah...</div>
                        </div>
                    </div>
                </div>

                <!-- Sidebar Column -->
                <div class="sidebar-column">
                    <!-- Upcoming Schedule -->
                    <div class="sidebar-card">
                        <div class="sidebar-title">Jadwal Kuliah Mendekat</div>
                        <div id="upcomingSchedule">
                            <div class="loading" style="padding: 20px;">Memuat...</div>
                        </div>
                    </div>

                    <!-- Enrolled Courses -->
                    <div class="sidebar-card">
                        <div class="sidebar-title">Mata Kuliah Diambil</div>
                        <div id="enrolledCourses">
                            <div class="loading" style="padding: 20px;">Memuat...</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Course Modal -->
        <div class="course-modal" id="courseModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 id="modalTitle">Detail Mata Kuliah</h2>
                    <button class="close-btn" onclick="closeCourseModal()">&times;</button>
                </div>
                
                <div class="error-message" id="moduleError"></div>
                
                <div id="courseContent">
                    <div class="loading">Memuat materi...</div>
                </div>
                
                <div class="edit-form" id="moduleForm" style="display: none;">
                    <h3 style="margin-bottom: 20px;">Tambah Modul</h3>
                    <div class="form-group">
                        <label class="form-label">Judul Modul</label>
                        <input type="text" class="form-input" id="moduleTitle" placeholder="Judul modul">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Deskripsi Modul</label>
                        <textarea class="form-textarea" id="moduleDescription" placeholder="Deskripsi modul"></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Upload File PDF</label>
                        <input type="file" class="form-input" id="moduleFileUpload" accept=".pdf" style="padding: 8px;">
                        <small style="color: #6c757d; display: block; margin-top: 5px;">
                            Atau gunakan link eksternal di bawah ini
                        </small>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Link File/Materi (Opsional)</label>
                        <input type="text" class="form-input" id="moduleFile" placeholder="Atau masukkan URL file eksternal">
                        <small style="color: #6c757d; display: block; margin-top: 5px;">
                            Kosongkan jika sudah upload file di atas
                        </small>
                    </div>
                    <div id="uploadProgress" style="display: none; margin-bottom: 15px;">
                        <div style="background: #e0e0e0; border-radius: 10px; height: 20px; overflow: hidden;">
                            <div id="progressBar" style="background: linear-gradient(45deg, #17a2b8, #138496); height: 100%; width: 0%; transition: width 0.3s;"></div>
                        </div>
                        <small id="progressText" style="color: #6c757d; display: block; margin-top: 5px;">Mengupload...</small>
                    </div>
                    <button class="save-btn" onclick="saveModule()">Simpan Modul</button>
                    <button class="cancel-btn" onclick="cancelModuleEdit()">Batal</button>
                </div>
                
                <button class="add-btn" id="addModuleBtn" onclick="showModuleForm()" style="display: none; margin-top: 20px;">+ Tambah Modul</button>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <script>
        const SUPABASE_URL = 'https://vahatmjmttmnhcadrnpl.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZhaGF0bWptdHRtbmhjYWRybnBsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk1MDQwNTgsImV4cCI6MjA3NTA4MDA1OH0._twKPzBrJKPEIZ9fC6-t5e_uxI5gqU_JPf0V_oudFXo';
        
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        
        let currentUser = null;
        let isAdminMode = false;
        let currentCourseId = null;
        let currentCourseDbId = null;

        document.body.classList.add('login-page');

        // User Dropdown Toggle
        function toggleUserDropdown() {
            const dropdown = document.getElementById('userDropdown');
            dropdown.classList.toggle('show');
        }

        // Close dropdown when clicking outside
        document.addEventListener('click', function(event) {
            const userMenu = document.querySelector('.user-menu');
            const dropdown = document.getElementById('userDropdown');
            if (userMenu && !userMenu.contains(event.target)) {
                dropdown.classList.remove('show');
            }
        });

        async function login() {
            const email = document.getElementById('loginEmail').value.trim();
            const password = document.getElementById('loginPassword').value;
            
            if (!email || !password) {
                showError('loginError', 'Harap isi email dan password!');
                return;
            }
            
            document.getElementById('loginSection').style.display = 'none';
            document.getElementById('loadingSpinner').style.display = 'block';
            hideError('loginError');
            
            try {
                const { data, error } = await supabase.auth.signInWithPassword({
                    email: email,
                    password: password
                });
                
                if (error) throw error;
                
                currentUser = data.user;
                
                const { data: roleData, error: roleError } = await supabase
                    .from('user_roles')
                    .select('role')
                    .eq('id', currentUser.id)
                    .single();
                
                if (roleError && roleError.code !== 'PGRST116') {
                    console.error('Role check error:', roleError);
                }
                
                isAdminMode = roleData && roleData.role === 'admin';
                
                document.getElementById('loginEmail').value = '';
                document.getElementById('loginPassword').value = '';
                hideError('loginError');
                
                document.body.classList.remove('login-page');
                
                showMainContent();
                
                await Promise.all([
                    loadAnnouncements(),
                    loadSchedules(),
                    loadCourses(),
                    loadSidebarData()
                ]);
                
            } catch (error) {
                console.error('Login error:', error);
                showError('loginError', 'Login gagal: ' + error.message);
                document.getElementById('loginSection').style.display = 'block';
                document.getElementById('loadingSpinner').style.display = 'none';
            }
        }
        
        async function logout() {
            try {
                await supabase.auth.signOut();
                currentUser = null;
                isAdminMode = false;
                hideMainContent();
            } catch (error) {
                console.error('Logout error:', error);
                alert('Gagal logout: ' + error.message);
            }
        }
        
        function showMainContent() {
            document.querySelector('.header').style.display = 'none';
            document.getElementById('mainContent').style.display = 'block';
            
            // Update user info in dropdown
            document.getElementById('userRole').textContent = isAdminMode ? 'Admin' : 'Student';
            document.getElementById('userEmail').textContent = currentUser.email;
            
            if (isAdminMode) {
                showAdminControls();
            }
        }
        
        function hideMainContent() {
            document.body.classList.add('login-page');
            document.querySelector('.header').style.display = 'block';
            document.getElementById('mainContent').style.display = 'none';
            document.getElementById('loginSection').style.display = 'block';
            document.getElementById('loadingSpinner').style.display = 'none';
            hideAdminControls();
        }
        
        function showAdminControls() {
            document.querySelectorAll('.admin-only').forEach(el => {
                el.style.display = 'table-cell';
            });
            
            document.querySelectorAll('.delete-btn').forEach(el => {
                el.style.display = 'inline-block';
            });
            
            document.getElementById('addAnnouncementBtn').style.display = 'block';
            document.getElementById('addScheduleBtn').style.display = 'block';
            document.getElementById('addCourseBtn').style.display = 'block';
        }
        
        function hideAdminControls() {
            document.querySelectorAll('.admin-only').forEach(el => {
                el.style.display = 'none';
            });
            
            document.querySelectorAll('.delete-btn').forEach(el => {
                el.style.display = 'none';
            });
            
            document.getElementById('addAnnouncementBtn').style.display = 'none';
            document.getElementById('addScheduleBtn').style.display = 'none';
            document.getElementById('addCourseBtn').style.display = 'none';
        }

        // Load Sidebar Data
        async function loadSidebarData() {
            try {
                // Load upcoming schedule
                const { data: schedules, error: schedError } = await supabase
                    .from('schedules')
                    .select('*')
                    .limit(3);
                
                const scheduleContainer = document.getElementById('upcomingSchedule');
                if (schedules && schedules.length > 0) {
                    scheduleContainer.innerHTML = schedules.map(s => `
                        <div class="schedule-item">
                            <div class="schedule-course">${escapeHtml(s.course)}</div>
                            <div class="schedule-time">${escapeHtml(s.day)}, ${escapeHtml(s.time)}</div>
                        </div>
                    `).join('');
                } else {
                    scheduleContainer.innerHTML = '<p style="color: #6c757d; text-align: center;">Tidak ada jadwal</p>';
                }

                // Load enrolled courses
                const { data: courses, error: courseError } = await supabase
                    .from('courses')
                    .select('*')
                    .limit(3);
                
                const courseContainer = document.getElementById('enrolledCourses');
                if (courses && courses.length > 0) {
                    courseContainer.innerHTML = courses.map(c => `
                        <div class="course-item">
                            <div class="course-name">${escapeHtml(c.title)}</div>
                        </div>
                    `).join('');
                } else {
                    courseContainer.innerHTML = '<p style="color: #6c757d; text-align: center;">Tidak ada mata kuliah</p>';
                }
            } catch (error) {
                console.error('Load sidebar error:', error);
            }
        }

        async function loadAnnouncements() {
            try {
                const { data, error } = await supabase
                    .from('announcements')
                    .select('*')
                    .order('date_created', { ascending: false });
                
                if (error) throw error;
                
                const container = document.getElementById('announcementsList');
                
                if (!data || data.length === 0) {
                    container.innerHTML = '<div class="loading">Belum ada pengumuman.</div>';
                    return;
                }
                
                container.innerHTML = data.map(announcement => `
                    <div class="announcement-card">
                        <div class="announcement-header">
                            <div>
                                <div class="announcement-title">${escapeHtml(announcement.title)}</div>
                                <div class="announcement-date">${formatDate(announcement.date_created)}</div>
                            </div>
                            ${isAdminMode ? `<button class="delete-btn" onclick="deleteAnnouncement('${announcement.id}')">Hapus</button>` : ''}
                        </div>
                        <div class="announcement-content">${escapeHtml(announcement.content)}</div>
                    </div>
                `).join('');
                
            } catch (error) {
                console.error('Load announcements error:', error);
                showError('announcementError', 'Gagal memuat pengumuman: ' + error.message);
            }
        }
        
        function showAnnouncementForm() {
            document.getElementById('announcementForm').style.display = 'block';
            document.getElementById('announcementTitle').value = '';
            document.getElementById('announcementContent').value = '';
        }
        
        function cancelAnnouncementEdit() {
            document.getElementById('announcementForm').style.display = 'none';
        }
        
        async function saveAnnouncement() {
            const title = document.getElementById('announcementTitle').value.trim();
            const content = document.getElementById('announcementContent').value.trim();
            
            if (!title || !content) {
                showError('announcementError', 'Harap isi semua field!');
                return;
            }
            
            try {
                const { error } = await supabase
                    .from('announcements')
                    .insert([{
                        title: title,
                        content: content,
                        created_by: currentUser.id
                    }]);
                
                if (error) throw error;
                
                await loadAnnouncements();
                cancelAnnouncementEdit();
                hideError('announcementError');
                
            } catch (error) {
                console.error('Save announcement error:', error);
                showError('announcementError', 'Gagal menyimpan pengumuman: ' + error.message);
            }
        }
        
        async function deleteAnnouncement(id) {
            if (!confirm('Yakin ingin menghapus pengumuman ini?')) return;
            
            try {
                const { error } = await supabase
                    .from('announcements')
                    .delete()
                    .eq('id', id);
                
                if (error) throw error;
                
                await loadAnnouncements();
                
            } catch (error) {
                console.error('Delete announcement error:', error);
                showError('announcementError', 'Gagal menghapus pengumuman: ' + error.message);
            }
        }

        async function loadSchedules() {
            try {
                const { data, error } = await supabase
                    .from('schedules')
                    .select('*')
                    .order('day', { ascending: true });
                
                if (error) throw error;
                
                const tbody = document.querySelector('#scheduleTable tbody');
                
                if (!data || data.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="5" class="loading">Belum ada jadwal.</td></tr>';
                    return;
                }
                
                const dayOrder = ['Senin', 'Selasa', 'Rabu', 'Kamis', 'Jumat', 'Sabtu'];
                data.sort((a, b) => dayOrder.indexOf(a.day) - dayOrder.indexOf(b.day));
                
                tbody.innerHTML = data.map(schedule => `
                    <tr>
                        <td>${escapeHtml(schedule.day)}</td>
                        <td class="time-slot">${escapeHtml(schedule.time)}</td>
                        <td>${escapeHtml(schedule.course)}</td>
                        <td>${escapeHtml(schedule.room)}</td>
                        <td class="admin-only">
                            <button class="delete-btn" onclick="deleteSchedule('${schedule.id}')">Hapus</button>
                        </td>
                    </tr>
                `).join('');
                
            } catch (error) {
                console.error('Load schedules error:', error);
                showError('scheduleError', 'Gagal memuat jadwal: ' + error.message);
            }
        }
        
        function showScheduleForm() {
            document.getElementById('scheduleForm').style.display = 'block';
            document.getElementById('scheduleDay').value = 'Senin';
            document.getElementById('scheduleTime').value = '';
            document.getElementById('scheduleCourse').value = '';
            document.getElementById('scheduleRoom').value = '';
        }
        
        function cancelScheduleEdit() {
            document.getElementById('scheduleForm').style.display = 'none';
        }
        
        async function saveSchedule() {
            const day = document.getElementById('scheduleDay').value;
            const time = document.getElementById('scheduleTime').value.trim();
            const course = document.getElementById('scheduleCourse').value.trim();
            const room = document.getElementById('scheduleRoom').value.trim();
            
            if (!time || !course || !room) {
                showError('scheduleError', 'Harap isi semua field!');
                return;
            }
            
            try {
                const { error } = await supabase
                    .from('schedules')
                    .insert([{
                        day: day,
                        time: time,
                        course: course,
                        room: room,
                        created_by: currentUser.id
                    }]);
                
                if (error) throw error;
                
                await loadSchedules();
                await loadSidebarData();
                cancelScheduleEdit();
                hideError('scheduleError');
                
            } catch (error) {
                console.error('Save schedule error:', error);
                showError('scheduleError', 'Gagal menyimpan jadwal: ' + error.message);
            }
        }
        
        async function deleteSchedule(id) {
            if (!confirm('Yakin ingin menghapus jadwal ini?')) return;
            
            try {
                const { error } = await supabase
                    .from('schedules')
                    .delete()
                    .eq('id', id);
                
                if (error) throw error;
                
                await loadSchedules();
                await loadSidebarData();
                
            } catch (error) {
                console.error('Delete schedule error:', error);
                showError('scheduleError', 'Gagal menghapus jadwal: ' + error.message);
            }
        }

        async function loadCourses() {
            try {
                const { data, error } = await supabase
                    .from('courses')
                    .select('*')
                    .order('created_at', { ascending: true });
                
                if (error) throw error;
                
                const container = document.getElementById('courseGrid');
                
                if (!data || data.length === 0) {
                    container.innerHTML = '<div class="loading">Belum ada mata kuliah.</div>';
                    return;
                }
                
                container.innerHTML = data.map(course => `
                    <div class="course-card">
                        <div class="course-title">${escapeHtml(course.title)}</div>
                        <div class="course-info">${escapeHtml(course.code)} • ${escapeHtml(course.lecturer)}</div>
                        <div class="course-description">${escapeHtml(course.description)}</div>
                        <button class="course-btn" onclick="openCourse('${course.id}', '${escapeHtml(course.course_id)}')">Akses Materi</button>
                        ${isAdminMode ? `<button class="delete-btn" onclick="deleteCourse('${course.id}')" style="margin-top: 10px; width: 100%;">Hapus Mata Kuliah</button>` : ''}
                    </div>
                `).join('');
                
            } catch (error) {
                console.error('Load courses error:', error);
                showError('courseError', 'Gagal memuat mata kuliah: ' + error.message);
            }
        }
        
        function showCourseForm() {
            document.getElementById('courseForm').style.display = 'block';
            document.getElementById('courseName').value = '';
            document.getElementById('courseCode').value = '';
            document.getElementById('courseLecturer').value = '';
            document.getElementById('courseDescription').value = '';
        }
        
        function cancelCourseEdit() {
            document.getElementById('courseForm').style.display = 'none';
        }
        
        async function saveCourse() {
            const name = document.getElementById('courseName').value.trim();
            const code = document.getElementById('courseCode').value.trim();
            const lecturer = document.getElementById('courseLecturer').value.trim();
            const description = document.getElementById('courseDescription').value.trim();
            
            if (!name || !code || !lecturer || !description) {
                showError('courseError', 'Harap isi semua field!');
                return;
            }
            
            const courseId = name.toLowerCase()
                .replace(/\s+/g, '-')
                .replace(/[^a-z0-9-]/g, '');
            
            try {
                const { error } = await supabase
                    .from('courses')
                    .insert([{
                        course_id: courseId,
                        title: name,
                        code: code,
                        lecturer: lecturer,
                        description: description,
                        created_by: currentUser.id
                    }]);
                
                if (error) throw error;
                
                await loadCourses();
                await loadSidebarData();
                cancelCourseEdit();
                hideError('courseError');
                
            } catch (error) {
                console.error('Save course error:', error);
                showError('courseError', 'Gagal menyimpan mata kuliah: ' + error.message);
            }
        }
        
        async function deleteCourse(id) {
            if (!confirm('Yakin ingin menghapus mata kuliah ini? Semua modul akan ikut terhapus.')) return;
            
            try {
                const { error } = await supabase
                    .from('courses')
                    .delete()
                    .eq('id', id);
                
                if (error) throw error;
                
                await loadCourses();
                await loadSidebarData();
                
            } catch (error) {
                console.error('Delete course error:', error);
                showError('courseError', 'Gagal menghapus mata kuliah: ' + error.message);
            }
        }

        async function openCourse(dbId, courseId) {
            currentCourseDbId = dbId;
            currentCourseId = courseId;
            
            try {
                const { data: courseData, error: courseError } = await supabase
                    .from('courses')
                    .select('*')
                    .eq('id', dbId)
                    .single();
                
                if (courseError) throw courseError;
                
                document.getElementById('modalTitle').textContent = courseData.title;
                
                const { data: modules, error: modulesError } = await supabase
                    .from('modules')
                    .select('*')
                    .eq('course_id', dbId)
                    .order('order_index', { ascending: true });
                
                if (modulesError) throw modulesError;
                
                let contentHtml = `
                    <div style="margin-bottom: 20px; padding: 20px; background: #f8f9fa; border-radius: 10px;">
                        <h3>Informasi Mata Kuliah</h3>
                        <p><strong>Kode:</strong> ${escapeHtml(courseData.code)}</p>
                        <p><strong>Dosen Pengampu:</strong> ${escapeHtml(courseData.lecturer)}</p>
                    </div>
                    
                    <h3 style="margin-bottom: 20px; color: #2c3e50;">📖 Modul Pembelajaran</h3>
                `;
                
                if (modules && modules.length > 0) {
                    contentHtml += modules.map(module => `
                        <div class="module-item">
                            <div class="module-title">${escapeHtml(module.title)}</div>
                            <div style="margin-bottom: 10px; color: #495057;">${escapeHtml(module.description)}</div>
                            <a href="${module.file_link === '#' ? '#' : escapeHtml(module.file_link)}" class="file-link" ${module.file_link === '#' ? 'onclick="alert(\'File belum tersedia\'); return false;"' : 'target="_blank"'}>
                                ${module.file_link === '#' ? 'File Placeholder' : 'Download Materi'}
                            </a>
                            ${isAdminMode ? `<button class="delete-btn" onclick="deleteModule('${module.id}')" style="float: right;">Hapus</button>` : ''}
                        </div>
                    `).join('');
                } else {
                    contentHtml += '<div style="text-align: center; color: #6c757d; padding: 40px;">Belum ada modul yang tersedia.</div>';
                }
                
                document.getElementById('courseContent').innerHTML = contentHtml;
                document.getElementById('addModuleBtn').style.display = isAdminMode ? 'block' : 'none';
                document.getElementById('courseModal').style.display = 'block';
                hideError('moduleError');
                
            } catch (error) {
                console.error('Open course error:', error);
                showError('moduleError', 'Gagal memuat mata kuliah: ' + error.message);
            }
        }
        
        function closeCourseModal() {
            document.getElementById('courseModal').style.display = 'none';
            document.getElementById('moduleForm').style.display = 'none';
            currentCourseDbId = null;
            currentCourseId = null;
        }
        
        function showModuleForm() {
            document.getElementById('moduleForm').style.display = 'block';
            document.getElementById('moduleTitle').value = '';
            document.getElementById('moduleDescription').value = '';
            document.getElementById('moduleFile').value = '';
            document.getElementById('moduleFileUpload').value = '';
            document.getElementById('uploadProgress').style.display = 'none';
            document.getElementById('progressBar').style.width = '0%';
        }
        
        function cancelModuleEdit() {
            document.getElementById('moduleForm').style.display = 'none';
        }
        
        async function saveModule() {
            const title = document.getElementById('moduleTitle').value.trim();
            const description = document.getElementById('moduleDescription').value.trim();
            const fileInput = document.getElementById('moduleFileUpload');
            const fileUrl = document.getElementById('moduleFile').value.trim();
            
            if (!title || !description) {
                showError('moduleError', 'Harap isi judul dan deskripsi modul!');
                return;
            }
            
            if (!currentCourseDbId) {
                showError('moduleError', 'Error: Course ID tidak ditemukan!');
                return;
            }
            
            let finalFileLink = '#';
            
            try {
                if (fileInput.files && fileInput.files[0]) {
                    const file = fileInput.files[0];
                    
                    if (file.type !== 'application/pdf') {
                        showError('moduleError', 'Hanya file PDF yang diperbolehkan!');
                        return;
                    }
                    
                    const maxSize = 10 * 1024 * 1024;
                    if (file.size > maxSize) {
                        showError('moduleError', 'Ukuran file terlalu besar! Maksimal 10MB.');
                        return;
                    }
                    
                    document.getElementById('uploadProgress').style.display = 'block';
                    document.getElementById('progressText').textContent = 'Mengupload file...';
                    document.getElementById('progressBar').style.width = '30%';
                    
                    const timestamp = Date.now();
                    const sanitizedTitle = title.toLowerCase()
                        .replace(/[^a-z0-9]/g, '-')
                        .replace(/-+/g, '-')
                        .substring(0, 50);
                    const fileName = `${timestamp}_${sanitizedTitle}.pdf`;
                    const filePath = `modules/${fileName}`;
                    
                    const { data: uploadData, error: uploadError } = await supabase.storage
                        .from('course-materials')
                        .upload(filePath, file, {
                            cacheControl: '3600',
                            upsert: false
                        });
                    
                    if (uploadError) throw uploadError;
                    
                    document.getElementById('progressBar').style.width = '70%';
                    
                    const { data: urlData } = supabase.storage
                        .from('course-materials')
                        .getPublicUrl(filePath);
                    
                    finalFileLink = urlData.publicUrl;
                    
                    document.getElementById('progressBar').style.width = '100%';
                    document.getElementById('progressText').textContent = 'Upload berhasil!';
                    
                } else if (fileUrl) {
                    finalFileLink = fileUrl;
                }
                
                const { data: existingModules, error: fetchError } = await supabase
                    .from('modules')
                    .select('order_index')
                    .eq('course_id', currentCourseDbId)
                    .order('order_index', { ascending: false })
                    .limit(1);
                
                if (fetchError) throw fetchError;
                
                const nextOrder = existingModules && existingModules.length > 0 
                    ? existingModules[0].order_index + 1 
                    : 1;
                
                const { error } = await supabase
                    .from('modules')
                    .insert([{
                        course_id: currentCourseDbId,
                        title: title,
                        description: description,
                        file_link: finalFileLink,
                        order_index: nextOrder,
                        created_by: currentUser.id
                    }]);
                
                if (error) throw error;
                
                document.getElementById('uploadProgress').style.display = 'none';
                document.getElementById('progressBar').style.width = '0%';
                
                await openCourse(currentCourseDbId, currentCourseId);
                cancelModuleEdit();
                hideError('moduleError');
                
            } catch (error) {
                console.error('Save module error:', error);
                document.getElementById('uploadProgress').style.display = 'none';
                showError('moduleError', 'Gagal menyimpan modul: ' + error.message);
            }
        }
        
        async function deleteModule(id) {
            if (!confirm('Yakin ingin menghapus modul ini?')) return;
            
            try {
                const { error } = await supabase
                    .from('modules')
                    .delete()
                    .eq('id', id);
                
                if (error) throw error;
                
                await openCourse(currentCourseDbId, currentCourseId);
                
            } catch (error) {
                console.error('Delete module error:', error);
                showError('moduleError', 'Gagal menghapus modul: ' + error.message);
            }
        }

        function showSection(sectionName) {
            document.querySelectorAll('.content-section').forEach(section => {
                section.style.display = 'none';
            });
            
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.getElementById(sectionName).style.display = 'block';
            event.target.classList.add('active');
        }

        function showError(elementId, message) {
            const errorEl = document.getElementById(elementId);
            errorEl.textContent = message;
            errorEl.style.display = 'block';
            
            setTimeout(() => {
                hideError(elementId);
            }, 5000);
        }
        
        function hideError(elementId) {
            const errorEl = document.getElementById(elementId);
            if (errorEl) errorEl.style.display = 'none';
        }
        
        function formatDate(dateString) {
            const date = new Date(dateString);
            const options = { day: 'numeric', month: 'long', year: 'numeric' };
            return date.toLocaleDateString('id-ID', options);
        }
        
        function escapeHtml(text) {
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        supabase.auth.getSession().then(({ data: { session } }) => {
            if (session) {
                currentUser = session.user;
                document.body.classList.remove('login-page');
                supabase
                    .from('user_roles')
                    .select('role')
                    .eq('id', currentUser.id)
                    .single()
                    .then(({ data }) => {
                        isAdminMode = data && data.role === 'admin';
                        showMainContent();
                        Promise.all([
                            loadAnnouncements(),
                            loadSchedules(),
                            loadCourses(),
                            loadSidebarData()
                        ]);
                    });
            }
        });
        
        supabase.auth.onAuthStateChange((event, session) => {
            if (event === 'SIGNED_OUT') {
                currentUser = null;
                isAdminMode = false;
                hideMainContent();
            }
        });
        
        document.getElementById('courseModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeCourseModal();
            }
        });
        
        document.getElementById('loginPassword').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                login();
            }
        });
    </script>
</body>
</html>
